<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2836. åœ¨ä¼ çƒæ¸¸æˆä¸­æœ€å¤§åŒ–å‡½æ•°å€¼ - LeetCode</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="top-bar">
        <button class="menu-button" onclick="history.back()" aria-label="è¿”å›">
            <div class="menu-icon">
                <span style="transform: rotate(-45deg) translateY(-2px);"></span>
                <span style="transform: rotate(45deg) translateY(2px);"></span>
            </div>
        </button>
        <div class="logo">
            <span class="logo-emoji">ğŸ“š</span>
            LeetCode æ¯æ—¥é¢˜ç›®
        </div>
        <div class="update-time">2026-02-26 19:55:57</div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content" style="margin-left: 0;">
        <div class="content-wrapper">
            <button class="back-button" onclick="history.back()">
                â† è¿”å›é¢˜ç›®åˆ—è¡¨
            </button>

            <div class="question-card">
                <div class="question-header">
                    <span class="question-number">2836. åœ¨ä¼ çƒæ¸¸æˆä¸­æœ€å¤§åŒ–å‡½æ•°å€¼</span>
                    <span class="difficulty-badge difficulty-hard">
                        å›°éš¾
                    </span>
                    <a href="https://leetcode.cn/problems/maximize-value-of-function-in-a-ball-passing-game/" target="_blank" class="question-link">åœ¨ LeetCode æ‰“å¼€</a>
                </div>
                <div class="markdown-content">
                    <h1 id="2836-åœ¨ä¼ çƒæ¸¸æˆä¸­æœ€å¤§åŒ–å‡½æ•°å€¼">2836. åœ¨ä¼ çƒæ¸¸æˆä¸­æœ€å¤§åŒ–å‡½æ•°å€¼</h1>

<p><strong>éš¾åº¦</strong>: Hard</p>

<p><strong>æ ‡ç­¾</strong>: ä½è¿ç®—, æ•°ç»„, åŠ¨æ€è§„åˆ’</p>

<p><strong>é“¾æ¥</strong>: https://leetcode.cn/problems/maximize-value-of-function-in-a-ball-passing-game/</p>

<hr />

<h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2>

<p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º <code>n</code>&nbsp;ä¸‹æ ‡ä» <strong>0</strong>&nbsp;å¼€å§‹çš„æ•´æ•°æ•°ç»„&nbsp;<code>receiver</code>&nbsp;å’Œä¸€ä¸ªæ•´æ•°&nbsp;<code>k</code>&nbsp;ã€‚</p>

<p>æ€»å…±æœ‰&nbsp;<code>n</code>&nbsp;åç©å®¶ï¼Œç©å®¶ <strong>ç¼–å·</strong>&nbsp;äº’ä¸ç›¸åŒï¼Œä¸”ä¸º&nbsp;<code>[0, n - 1]</code>&nbsp;ä¸­çš„æ•´æ•°ã€‚è¿™äº›ç©å®¶ç©ä¸€ä¸ªä¼ çƒæ¸¸æˆï¼Œ<code>receiver[i]</code>&nbsp;è¡¨ç¤ºç¼–å·ä¸º <code>i</code>&nbsp;çš„ç©å®¶ä¼šä¼ çƒç»™ç¼–å·ä¸º <code>receiver[i]</code>&nbsp;çš„ç©å®¶ã€‚ç©å®¶å¯ä»¥ä¼ çƒç»™è‡ªå·±ï¼Œä¹Ÿå°±æ˜¯è¯´&nbsp;<code>receiver[i]</code>&nbsp;å¯èƒ½ç­‰äº&nbsp;<code>i</code>&nbsp;ã€‚</p>

<p>ä½ éœ€è¦ä» <code>n</code>&nbsp;åç©å®¶ä¸­é€‰æ‹©ä¸€åç©å®¶ä½œä¸ºæ¸¸æˆå¼€å§‹æ—¶å”¯ä¸€æ‰‹ä¸­æœ‰çƒçš„ç©å®¶ï¼Œçƒä¼šè¢«ä¼  <strong>æ°å¥½</strong>&nbsp;<code>k</code>&nbsp;æ¬¡ã€‚</p>

<p>å¦‚æœé€‰æ‹©ç¼–å·ä¸º <code>x</code>&nbsp;çš„ç©å®¶ä½œä¸ºå¼€å§‹ç©å®¶ï¼Œå®šä¹‰å‡½æ•°&nbsp;<code>f(x)</code>&nbsp;è¡¨ç¤ºä»ç¼–å·ä¸º&nbsp;<code>x</code>&nbsp;çš„ç©å®¶å¼€å§‹ï¼Œ<code>k</code>&nbsp;æ¬¡ä¼ çƒå†…æ‰€æœ‰æ¥è§¦è¿‡çƒç©å®¶çš„ç¼–å·ä¹‹&nbsp;<strong>å’Œ</strong>&nbsp;ï¼Œå¦‚æœæœ‰ç©å®¶å¤šæ¬¡è§¦çƒï¼Œåˆ™ <strong>ç´¯åŠ å¤šæ¬¡</strong>&nbsp;ã€‚æ¢å¥è¯è¯´ï¼Œ&nbsp;<code>f(x) = x + receiver[x] + receiver[receiver[x]] + ... + receiver<sup>(k)</sup>[x]</code>&nbsp;ã€‚</p>

<p>ä½ çš„ä»»åŠ¡æ—¶é€‰æ‹©å¼€å§‹ç©å®¶ <code>x</code>&nbsp;ï¼Œç›®çš„æ˜¯<strong>&nbsp;æœ€å¤§åŒ–</strong>&nbsp;<code>f(x)</code>&nbsp;ã€‚</p>

<p>è¯·ä½ è¿”å›å‡½æ•°çš„ <strong>æœ€å¤§å€¼</strong>&nbsp;ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong><code>receiver</code>&nbsp;å¯èƒ½å«æœ‰é‡å¤å…ƒç´ ã€‚</p>

<p>&nbsp;</p>

<p><strong class="example">ç¤ºä¾‹ 1ï¼š</strong></p>

<table border="1" cellspacing="3" style="border-collapse: separate; text-align: center;">
    <tbody>
        <tr>
            <th style="padding: 5px; border: 1px solid black;">ä¼ é€’æ¬¡æ•°</th>
            <th style="padding: 5px; border: 1px solid black;">ä¼ çƒè€…ç¼–å·</th>
            <th style="padding: 5px; border: 1px solid black;">æ¥çƒè€…ç¼–å·</th>
            <th style="padding: 5px; border: 1px solid black;">x + æ‰€æœ‰æ¥çƒè€…ç¼–å·</th>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">&nbsp;</td>
            <td style="padding: 5px; border: 1px solid black;">&nbsp;</td>
            <td style="padding: 5px; border: 1px solid black;">&nbsp;</td>
            <td style="padding: 5px; border: 1px solid black;">2</td>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">1</td>
            <td style="padding: 5px; border: 1px solid black;">2</td>
            <td style="padding: 5px; border: 1px solid black;">1</td>
            <td style="padding: 5px; border: 1px solid black;">3</td>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">2</td>
            <td style="padding: 5px; border: 1px solid black;">1</td>
            <td style="padding: 5px; border: 1px solid black;">0</td>
            <td style="padding: 5px; border: 1px solid black;">3</td>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">3</td>
            <td style="padding: 5px; border: 1px solid black;">0</td>
            <td style="padding: 5px; border: 1px solid black;">2</td>
            <td style="padding: 5px; border: 1px solid black;">5</td>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">4</td>
            <td style="padding: 5px; border: 1px solid black;">2</td>
            <td style="padding: 5px; border: 1px solid black;">1</td>
            <td style="padding: 5px; border: 1px solid black;">6</td>
        </tr>
    </tbody>
</table>

<p>&nbsp;</p>

<pre>
<b>è¾“å…¥ï¼š</b>receiver = [2,0,1], k = 4
<b>è¾“å‡ºï¼š</b>6
<b>è§£é‡Šï¼š</b>ä¸Šè¡¨å±•ç¤ºäº†ä»ç¼–å·ä¸º x = 2 å¼€å§‹çš„æ¸¸æˆè¿‡ç¨‹ã€‚
ä»è¡¨ä¸­å¯çŸ¥ï¼Œf(2) ç­‰äº 6 ã€‚
6 æ˜¯èƒ½å¾—åˆ°æœ€å¤§çš„å‡½æ•°å€¼ã€‚
æ‰€ä»¥è¾“å‡ºä¸º 6 ã€‚
</pre>

<p><strong class="example">ç¤ºä¾‹ 2ï¼š</strong></p>

<table border="1" cellspacing="3" style="border-collapse: separate; text-align: center;">
    <tbody>
        <tr>
            <th style="padding: 5px; border: 1px solid black;">ä¼ é€’æ¬¡æ•°</th>
            <th style="padding: 5px; border: 1px solid black;">ä¼ çƒè€…ç¼–å·</th>
            <th style="padding: 5px; border: 1px solid black;">æ¥çƒè€…ç¼–å·</th>
            <th style="padding: 5px; border: 1px solid black;">x + æ‰€æœ‰æ¥çƒè€…ç¼–å·</th>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">&nbsp;</td>
            <td style="padding: 5px; border: 1px solid black;">&nbsp;</td>
            <td style="padding: 5px; border: 1px solid black;">&nbsp;</td>
            <td style="padding: 5px; border: 1px solid black;">4</td>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">1</td>
            <td style="padding: 5px; border: 1px solid black;">4</td>
            <td style="padding: 5px; border: 1px solid black;">3</td>
            <td style="padding: 5px; border: 1px solid black;">7</td>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">2</td>
            <td style="padding: 5px; border: 1px solid black;">3</td>
            <td style="padding: 5px; border: 1px solid black;">2</td>
            <td style="padding: 5px; border: 1px solid black;">9</td>
        </tr>
        <tr>
            <td style="padding: 5px; border: 1px solid black;">3</td>
            <td style="padding: 5px; border: 1px solid black;">2</td>
            <td style="padding: 5px; border: 1px solid black;">1</td>
            <td style="padding: 5px; border: 1px solid black;">10</td>
        </tr>
    </tbody>
</table>

<p>&nbsp;</p>

<pre>
<b>è¾“å…¥ï¼š</b>receiver = [1,1,1,2,3], k = 3
<b>è¾“å‡ºï¼š</b>10
<b>è§£é‡Šï¼š</b>ä¸Šè¡¨å±•ç¤ºäº†ä»ç¼–å·ä¸º x = 4 å¼€å§‹çš„æ¸¸æˆè¿‡ç¨‹ã€‚
ä»è¡¨ä¸­å¯çŸ¥ï¼Œf(4) ç­‰äº 10 ã€‚
10 æ˜¯èƒ½å¾—åˆ°æœ€å¤§çš„å‡½æ•°å€¼ã€‚
æ‰€ä»¥è¾“å‡ºä¸º 10 ã€‚
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
    <li><code>1 &lt;= receiver.length == n &lt;= 10<sup>5</sup></code></li>
    <li><code>0 &lt;= receiver[i] &lt;= n - 1</code></li>
    <li><code>1 &lt;= k &lt;= 10<sup>10</sup></code></li>
</ul>

<hr />

<h2 id="ä»£ç æ¨¡æ¿">ä»£ç æ¨¡æ¿</h2>

<h3 id="c">C++</h3>

<pre><code>class Solution {
public:
    long long getMaxFunctionValue(vector&lt;int&gt;&amp; receiver, long long k) {

    }
};
</code></pre>

<h3 id="java">Java</h3>

<pre><code>class Solution {
    public long getMaxFunctionValue(List&lt;Integer&gt; receiver, long k) {

    }
}
</code></pre>

<h3 id="python3">Python3</h3>

<pre><code>class Solution:
    def getMaxFunctionValue(self, receiver: List[int], k: int) -&gt; int:

</code></pre>

<h3 id="javascript">JavaScript</h3>

<pre><code>/**
 * @param {number[]} receiver
 * @param {number} k
 * @return {number}
 */
var getMaxFunctionValue = function(receiver, k) {

};
</code></pre>

<h3 id="go">Go</h3>

<pre><code>func getMaxFunctionValue(receiver []int, k int64) int64 {

}
</code></pre>

<hr />

<h2 id="æç¤º">æç¤º</h2>

<ol>
<li><div class="_1l1MA">We can solve the problem using binary lifting.</div></li>
<li><div class="_1l1MA">For each player with id <code>x</code> and for every <code>i</code> in the range <code>[0, ceil(log<sub>2</sub>k)]</code>, we can determine the last receiver's id and compute the sum of player ids who receive the ball after <code>2<sup>i</sup></code> passes, starting from <code>x</code>.</div></li>
<li><div class="_1l1MA">Let <code>last<em>receiver[x][i] =</code> the last receiver's id after <code>2<sup>i</sup></code> passes, and <code>sum[x][i] =</code> the sum of player ids who receive the ball after <code>2<sup>i</sup></code> passes. For all <code>x</code> in the range <code>[0, n - 1]</code>, <code>last</em>receiver[x][0] = receiver[x]</code>, and <code>sum[x][0] = receiver[x]</code>.</div></li>
<li><div class="_1l1MA">Then for <code>i</code> in range <code>[1, ceil(log<sub>2</sub>k)]</code>,Â <code>last<em>receiver[x][i] = last</em>receiver[last<em>receiver[x][i - 1]][i - 1]</code> and <code>sum[x][i] = sum[x][i - 1] + sum[last</em>receiver[x][i - 1]][i - 1]</code>, for all <code>x</code> in the range <code>[0, n - 1]</code>.</div></li>
<li><div class="_1l1MA">Starting from each player id <code>x</code>, we can now go through the powers of <code>2</code> in the binary representation of <code>k</code> and make jumps corresponding to each power, using the pre-computed values, to compute <code>f(x)</code>.</div></li>
<li><div class="_1l1MA">The answer is the maximum <code>f(x)</code> from each player id.</div></li>
</ol>

<hr />

<h2 id="ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹">ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹</h2>

<pre><code>[2,0,1]
4
</code></pre>

<hr />

<h2 id="ai-è§£ç­”-deepseek">AI è§£ç­” (DeepSeek)</h2>

<h2 id="é¢˜ç›®åˆ†æ">é¢˜ç›®åˆ†æ</h2>

<p>é¢˜ç›®æè¿°äº†ä¸€ä¸ªä¼ çƒæ¸¸æˆï¼š
- æœ‰ n ä¸ªç©å®¶ï¼Œç¼–å· 0 åˆ° n-1
- æ•°ç»„ <code>receiver[i]</code> è¡¨ç¤ºç©å®¶ i ä¼šä¼ çƒç»™ç©å®¶ <code>receiver[i]</code>
- å¯ä»¥é€‰æ‹©ä»»æ„ç©å®¶ x ä½œä¸ºèµ·å§‹ç©å®¶
- çƒä¼šè¢«ä¼ æ°å¥½ k æ¬¡
- å®šä¹‰ <code>f(x) = x + receiver[x] + receiver[receiver[x]] + ... + receiver^(k)[x]</code>
- ç›®æ ‡æ˜¯æœ€å¤§åŒ– <code>f(x)</code></p>

<p><strong>å…³é”®ç‚¹</strong>ï¼š
1. k æœ€å¤§å¯è¾¾ 10^10ï¼Œä¸èƒ½æ¨¡æ‹Ÿ k æ­¥
2. n æœ€å¤§ 10^5ï¼Œéœ€è¦é«˜æ•ˆç®—æ³•
3. ä¼ çƒè·¯å¾„å¯èƒ½å½¢æˆç¯
4. éœ€è¦å¿«é€Ÿè®¡ç®—ä»æ¯ä¸ªç‚¹å‡ºå‘èµ° k æ­¥çš„è·¯å¾„å’Œ</p>

<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>

<h3 id="æ ¸å¿ƒæ€æƒ³äºŒè¿›åˆ¶å€å¢binary-lifting">æ ¸å¿ƒæ€æƒ³ï¼šäºŒè¿›åˆ¶å€å¢ï¼ˆBinary Liftingï¼‰</h3>

<p>ç”±äº k å¾ˆå¤§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ O(log k) æ—¶é—´å†…è®¡ç®—ä»ä»»æ„ç‚¹å‡ºå‘èµ° k æ­¥çš„è·¯å¾„å’Œã€‚è¿™å¯ä»¥é€šè¿‡é¢„å¤„ç†æ¥å®ç°ï¼š
- <code>jump[i][j]</code>ï¼šä» i å‡ºå‘èµ° 2^j æ­¥åˆ°è¾¾çš„èŠ‚ç‚¹
- <code>sum[i][j]</code>ï¼šä» i å‡ºå‘èµ° 2^j æ­¥çš„è·¯å¾„å’Œï¼ˆåŒ…æ‹¬èµ·ç‚¹ï¼‰</p>

<h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤ï¼š</h3>

<ol>
<li>é¢„å¤„ç†äºŒè¿›åˆ¶è·³è·ƒè¡¨</li>
<li>å¯¹äºæ¯ä¸ªèµ·å§‹ç‚¹ xï¼Œä½¿ç”¨äºŒè¿›åˆ¶åˆ†è§£è®¡ç®— k æ­¥çš„è·¯å¾„å’Œ</li>
<li>å–æ‰€æœ‰èµ·å§‹ç‚¹çš„æœ€å¤§å€¼</li>
</ol>

<h2 id="è§£æ³•ä¸€äºŒè¿›åˆ¶å€å¢æ ‡å‡†è§£æ³•">è§£æ³•ä¸€ï¼šäºŒè¿›åˆ¶å€å¢ï¼ˆæ ‡å‡†è§£æ³•ï¼‰</h2>

<h3 id="æ€è·¯">æ€è·¯</h3>

<ul>
<li>é¢„å¤„ç† <code>jump[i][j]</code> å’Œ <code>sum[i][j]</code></li>
<li><code>jump[i][0] = receiver[i]</code></li>
<li><code>sum[i][0] = i</code>ï¼ˆæ³¨æ„ï¼šè¿™é‡ŒåªåŒ…å«èµ·ç‚¹ iï¼Œä¸åŒ…å« receiver[i]ï¼‰</li>
<li>é€’æ¨å…¬å¼ï¼š
<ul>
<li><code>jump[i][j] = jump[jump[i][j-1]][j-1]</code></li>
<li><code>sum[i][j] = sum[i][j-1] + sum[jump[i][j-1]][j-1]</code></li>
</ul></li>
<li>è®¡ç®— f(x) æ—¶ï¼Œä» x å‡ºå‘ï¼ŒæŒ‰ k çš„äºŒè¿›åˆ¶ä½ç´¯åŠ </li>
</ul>

<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>

<pre><code>func getMaxFunctionValue(receiver []int, k int64) int64 {
    n := len(receiver)
    m := 0
    for (1 &lt;&lt; m) &lt;= int(k) {
        m++
    }
    m++ // å¤šå¼€ä¸€ä½ä¿è¯å®‰å…¨

    // jump[i][j]: ä» i å‡ºå‘èµ° 2^j æ­¥åˆ°è¾¾çš„èŠ‚ç‚¹
    jump := make([][]int, n)
    // sum[i][j]: ä» i å‡ºå‘èµ° 2^j æ­¥çš„è·¯å¾„å’Œï¼ˆåŒ…å«èµ·ç‚¹ï¼‰
    sum := make([][]int64, n)
    for i := 0; i &lt; n; i++ {
        jump[i] = make([]int, m)
        sum[i] = make([]int64, m)
    }

    // åˆå§‹åŒ–
    for i := 0; i &lt; n; i++ {
        jump[i][0] = receiver[i]
        sum[i][0] = int64(i) // åªåŒ…å«èµ·ç‚¹
    }

    // é¢„å¤„ç†å€å¢è¡¨
    for j := 1; j &lt; m; j++ {
        for i := 0; i &lt; n; i++ {
            mid := jump[i][j-1]
            jump[i][j] = jump[mid][j-1]
            sum[i][j] = sum[i][j-1] + sum[mid][j-1]
        }
    }

    var ans int64 = 0
    // å¯¹æ¯ä¸ªèµ·ç‚¹è®¡ç®— f(x)
    for x := 0; x &lt; n; x++ {
        cur := x
        var total int64 = 0
        kk := k

        for j := 0; j &lt; m; j++ {
            if (kk&gt;&gt;j)&amp;1 == 1 {
                total += sum[cur][j]
                cur = jump[cur][j]
            }
        }
        // æ³¨æ„ï¼šæœ€åè¦åŠ ä¸Šç»ˆç‚¹çš„å€¼
        // å› ä¸º sum[cur][j] åªåŒ…å«èµ·ç‚¹ï¼Œä¸åŒ…å«ç»ˆç‚¹
        // è€Œ f(x) éœ€è¦åŒ…å«æ‰€æœ‰ç»è¿‡çš„èŠ‚ç‚¹
        total += int64(cur)

        if total &gt; ans {
            ans = total
        }
    }

    return ans
}
</code></pre>

<pre><code>#include &lt;vector&gt;
#include &lt;algorithm&gt;
#include &lt;cmath&gt;
using namespace std;

class Solution {
public:
    long long getMaxFunctionValue(vector&lt;int&gt;&amp; receiver, long long k) {
        int n = receiver.size();
        int m = 0;
        while ((1LL &lt;&lt; m) &lt;= k) m++;
        m++; // å¤šå¼€ä¸€ä½

        // jump[i][j]: ä» i å‡ºå‘èµ° 2^j æ­¥åˆ°è¾¾çš„èŠ‚ç‚¹
        vector&lt;vector&lt;int&gt;&gt; jump(n, vector&lt;int&gt;(m));
        // sum[i][j]: ä» i å‡ºå‘èµ° 2^j æ­¥çš„è·¯å¾„å’Œï¼ˆåŒ…å«èµ·ç‚¹ï¼‰
        vector&lt;vector&lt;long long&gt;&gt; sum(n, vector&lt;long long&gt;(m));

        // åˆå§‹åŒ–
        for (int i = 0; i &lt; n; i++) {
            jump[i][0] = receiver[i];
            sum[i][0] = i; // åªåŒ…å«èµ·ç‚¹
        }

        // é¢„å¤„ç†å€å¢è¡¨
        for (int j = 1; j &lt; m; j++) {
            for (int i = 0; i &lt; n; i++) {
                int mid = jump[i][j-1];
                jump[i][j] = jump[mid][j-1];
                sum[i][j] = sum[i][j-1] + sum[mid][j-1];
            }
        }

        long long ans = 0;
        // å¯¹æ¯ä¸ªèµ·ç‚¹è®¡ç®— f(x)
        for (int x = 0; x &lt; n; x++) {
            int cur = x;
            long long total = 0;
            long long kk = k;

            for (int j = 0; j &lt; m; j++) {
                if ((kk &gt;&gt; j) &amp; 1) {
                    total += sum[cur][j];
                    cur = jump[cur][j];
                }
            }
            // åŠ ä¸Šç»ˆç‚¹çš„å€¼
            total += cur;

            ans = max(ans, total);
        }

        return ans;
    }
};
</code></pre>

<h3 id="å¤æ‚åº¦åˆ†æ">å¤æ‚åº¦åˆ†æ</h3>

<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log k)
<ul>
<li>é¢„å¤„ç†ï¼šO(n log k)</li>
<li>æŸ¥è¯¢æ¯ä¸ªèµ·ç‚¹ï¼šO(n log k)</li>
</ul></li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n log k)</li>
</ul>

<h2 id="è§£æ³•äºŒäºŒè¿›åˆ¶å€å¢ä¼˜åŒ–ç©ºé—´">è§£æ³•äºŒï¼šäºŒè¿›åˆ¶å€å¢ï¼ˆä¼˜åŒ–ç©ºé—´ï¼‰</h2>

<h3 id="æ€è·¯-2">æ€è·¯</h3>

<ul>
<li>æ³¨æ„åˆ° k æœ€å¤§ 10^10ï¼Œlog2(k) â‰ˆ 34</li>
<li>ä½† n æœ€å¤§ 10^5ï¼Œn * log k çš„ç©ºé—´å¯èƒ½è¾ƒå¤§</li>
<li>å¯ä»¥ä¼˜åŒ–ï¼šåªå­˜å‚¨å¿…è¦çš„è·³è·ƒä¿¡æ¯ï¼Œæˆ–è€…ä½¿ç”¨æ»šåŠ¨æ•°ç»„</li>
</ul>

<h3 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h3>

<pre><code>func getMaxFunctionValue(receiver []int, k int64) int64 {
    n := len(receiver)
    m := 0
    for (1 &lt;&lt; m) &lt;= int(k) {
        m++
    }
    m++

    // ä½¿ç”¨ä¸¤ä¸ªæ•°ç»„äº¤æ›¿è®¡ç®—
    jump := make([]int, n)
    nextJump := make([]int, n)
    sum := make([]int64, n)
    nextSum := make([]int64, n)

    // åˆå§‹åŒ–
    for i := 0; i &lt; n; i++ {
        jump[i] = receiver[i]
        sum[i] = int64(i)
    }

    var ans int64 = 0
    kk := k

    for j := 0; j &lt; m; j++ {
        if (kk&gt;&gt;j)&amp;1 == 1 {
            // è®¡ç®—å½“å‰äºŒè¿›åˆ¶ä½çš„è´¡çŒ®
            for i := 0; i &lt; n; i++ {
                nextJump[i] = jump[jump[i]]
                nextSum[i] = sum[i] + sum[jump[i]]
            }
            // æ›´æ–°ç­”æ¡ˆ
            for i := 0; i &lt; n; i++ {
                curAns := nextSum[i] + int64(nextJump[i])
                if curAns &gt; ans {
                    ans = curAns
                }
            }
            // äº¤æ¢æ•°ç»„
            jump, nextJump = nextJump, jump
            sum, nextSum = nextSum, sum
        }

        // å‡†å¤‡ä¸‹ä¸€è½®
        if j &lt; m-1 {
            for i := 0; i &lt; n; i++ {
                nextJump[i] = jump[jump[i]]
                nextSum[i] = sum[i] + sum[jump[i]]
            }
            jump, nextJump = nextJump, jump
            sum, nextSum = nextSum, sum
        }
    }

    return ans
}
</code></pre>

<pre><code>#include &lt;vector&gt;
#include &lt;algorithm&gt;
using namespace std;

class Solution {
public:
    long long getMaxFunctionValue(vector&lt;int&gt;&amp; receiver, long long k) {
        int n = receiver.size();
        int m = 0;
        while ((1LL &lt;&lt; m) &lt;= k) m++;
        m++;

        vector&lt;int&gt; jump(n), nextJump(n);
        vector&lt;long long&gt; sum(n), nextSum(n);

        // åˆå§‹åŒ–
        for (int i = 0; i &lt; n; i++) {
            jump[i] = receiver[i];
            sum[i] = i;
        }

        long long ans = 0;
        long long kk = k;

        for (int j = 0; j &lt; m; j++) {
            if ((kk &gt;&gt; j) &amp; 1) {
                // è®¡ç®—å½“å‰äºŒè¿›åˆ¶ä½çš„è´¡çŒ®
                for (int i = 0; i &lt; n; i++) {
                    nextJump[i] = jump[jump[i]];
                    nextSum[i] = sum[i] + sum[jump[i]];
                }
                // æ›´æ–°ç­”æ¡ˆ
                for (int i = 0; i &lt; n; i++) {
                    long long curAns = nextSum[i] + nextJump[i];
                    ans = max(ans, curAns);
                }
                // äº¤æ¢
                swap(jump, nextJump);
                swap(sum, nextSum);
            }

            // å‡†å¤‡ä¸‹ä¸€è½®
            if (j &lt; m - 1) {
                for (int i = 0; i &lt; n; i++) {
                    nextJump[i] = jump[jump[i]];
                    nextSum[i] = sum[i] + sum[jump[i]];
                }
                swap(jump, nextJump);
                swap(sum, nextSum);
            }
        }

        return ans;
    }
};
</code></pre>

<h3 id="å¤æ‚åº¦åˆ†æ-2">å¤æ‚åº¦åˆ†æ</h3>

<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log k)</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼ˆä¼˜åŒ–äº†ç©ºé—´ï¼‰</li>
</ul>

<h2 id="è§£æ³•ä¸‰ç¯åˆ†è§£-å€å¢">è§£æ³•ä¸‰ï¼šç¯åˆ†è§£ + å€å¢</h2>

<h3 id="æ€è·¯-3">æ€è·¯</h3>

<ol>
<li>ç”±äºä¼ çƒå…³ç³»å½¢æˆåŠŸèƒ½å›¾ï¼ˆæ¯ä¸ªç‚¹å‡ºåº¦ä¸º1ï¼‰ï¼Œæ‰€ä»¥æ¯ä¸ªè¿é€šåˆ†é‡æ˜¯ä¸€ä¸ªç¯åŠ ä¸Šæ ‘æ</li>
<li>å¯¹äºæ¯ä¸ªç‚¹ï¼Œèµ°è¶³å¤Ÿå¤šæ­¥åä¸€å®šä¼šè¿›å…¥ç¯</li>
<li>å¯ä»¥å…ˆç”¨å€å¢æ‰¾åˆ°è¿›å…¥ç¯åçš„ä½ç½®ï¼Œç„¶åè®¡ç®—ç¯ä¸Šçš„è´¡çŒ®</li>
</ol>

<h3 id="ä»£ç å®ç°-3">ä»£ç å®ç°</h3>

<pre><code>func getMaxFunctionValue(receiver []int, k int64) int64 {
    n := len(receiver)
    m := 0
    for (1 &lt;&lt; m) &lt;= int(k) {
        m++
    }
    m++

    jump := make([][]int, n)
    sum := make([][]int64, n)
    for i := 0; i &lt; n; i++ {
        jump[i] = make([]int, m)
        sum[i] = make([]int64, m)
    }

    // åˆå§‹åŒ–
    for i := 0; i &lt; n; i++ {
        jump[i][0] = receiver[i]
        sum[i][0] = int64(i)
    }

    // é¢„å¤„ç†
    for j := 1; j &lt; m; j++ {
        for i := 0; i &lt; n; i++ {
            mid := jump[i][j-1]
            jump[i][j] = jump[mid][j-1]
            sum[i][j] = sum[i][j-1] + sum[mid][j-1]
        }
    }

    var ans int64 = 0
    for x := 0; x &lt; n; x++ {
        cur := x
        var total int64 = 0
        kk := k

        for j := 0; j &lt; m; j++ {
            if (kk&gt;&gt;j)&amp;1 == 1 {
                total += sum[cur][j]
                cur = jump[cur][j]
            }
        }
        total += int64(cur)

        if total &gt; ans {
            ans = total
        }
    }

    return ans
}
</code></pre>

<pre><code>#include &lt;vector&gt;
#include &lt;algorithm&gt;
using namespace std;

class Solution {
public:
    long long getMaxFunctionValue(vector&lt;int&gt;&amp; receiver, long long k) {
        int n = receiver.size();
        int m = 0;
        while ((1LL &lt;&lt; m) &lt;= k) m++;
        m++;

        vector&lt;vector&lt;int&gt;&gt; jump(n, vector&lt;int&gt;(m));
        vector&lt;vector&lt;long long&gt;&gt; sum(n, vector&lt;long long&gt;(m));

        // åˆå§‹åŒ–
        for (int i = 0; i &lt; n; i++) {
            jump[i][0] = receiver[i];
            sum[i][0] = i;
        }

        // é¢„å¤„ç†
        for (int j = 1; j &lt; m; j++) {
            for (int i = 0; i &lt; n; i++) {
                int mid = jump[i][j-1];
                jump[i][j] = jump[mid][j-1];
                sum[i][j] = sum[i][j-1] + sum[mid][j-1];
            }
        }

        long long ans = 0;
        for (int x = 0; x &lt; n; x++) {
            int cur = x;
            long long total = 0;
            long long kk = k;

            for (int j = 0; j &lt; m; j++) {
                if ((kk &gt;&gt; j) &amp; 1) {
                    total += sum[cur][j];
                    cur = jump[cur][j];
                }
            }
            total += cur;

            ans = max(ans, total);
        }

        return ans;
    }
};
</code></pre>

<h3 id="å¤æ‚åº¦åˆ†æ-3">å¤æ‚åº¦åˆ†æ</h3>

<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log k)</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n log k)</li>
</ul>

<h2 id="è§£æ³•å¯¹æ¯”">è§£æ³•å¯¹æ¯”</h2>

<table>
<thead>
<tr>
  <th>è§£æ³•</th>
  <th>æ—¶é—´å¤æ‚åº¦</th>
  <th>ç©ºé—´å¤æ‚åº¦</th>
  <th>ä¼˜ç‚¹</th>
  <th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
  <td>è§£æ³•ä¸€ï¼šæ ‡å‡†å€å¢</td>
  <td>O(n log k)</td>
  <td>O(n log k)</td>
  <td>æ€è·¯æ¸…æ™°ï¼Œå®ç°ç®€å•</td>
  <td>ç©ºé—´å¼€é”€è¾ƒå¤§</td>
</tr>
<tr>
  <td>è§£æ³•äºŒï¼šä¼˜åŒ–ç©ºé—´</td>
  <td>O(n log k)</td>
  <td>O(n)</td>
  <td>ç©ºé—´ä¼˜åŒ–ï¼Œé€‚åˆå†…å­˜ç´§å¼ </td>
  <td>å®ç°ç¨å¤æ‚ï¼Œå¸¸æ•°è¾ƒå¤§</td>
</tr>
<tr>
  <td>è§£æ³•ä¸‰ï¼šç¯åˆ†è§£+å€å¢</td>
  <td>O(n log k)</td>
  <td>O(n log k)</td>
  <td>åˆ©ç”¨å›¾ç‰¹æ€§ï¼Œç†è®ºæœ€ä¼˜</td>
  <td>å®ç°å¤æ‚ï¼Œå®é™…æ€§èƒ½å·®å¼‚ä¸å¤§</td>
</tr>
</tbody>
</table>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<ol>
<li><strong>æ¨èè§£æ³•ä¸€</strong>ï¼šæ ‡å‡†äºŒè¿›åˆ¶å€å¢æ³•ï¼Œæ€è·¯æ¸…æ™°ï¼Œä»£ç ç®€æ´ï¼Œåœ¨æ¯”èµ›ä¸­å®ç°å¿«é€Ÿ</li>
<li>å¯¹äºç‰¹åˆ«å¤§çš„ n å’Œ kï¼Œè§£æ³•äºŒçš„ç©ºé—´ä¼˜åŒ–æ›´æœ‰ä¼˜åŠ¿</li>
<li>å®é™…æ¯”èµ›ä¸­ï¼Œè§£æ³•ä¸€å·²ç»è¶³å¤Ÿï¼Œå› ä¸º n log k â‰ˆ 10^5 * 34 â‰ˆ 3.4M çš„è·³è·ƒè¡¨æ˜¯å¯ä»¥æ¥å—çš„</li>
</ol>

<p><strong>å…³é”®ç‚¹</strong>ï¼š
- äºŒè¿›åˆ¶å€å¢æ˜¯å¤„ç†å¤§ k é—®é¢˜çš„æ ‡å‡†æŠ€å·§
- æ³¨æ„ sum æ•°ç»„çš„å®šä¹‰ï¼šåªåŒ…å«èµ·ç‚¹ï¼Œä¸åŒ…å«ç»ˆç‚¹
- æœ€åéœ€è¦åŠ ä¸Šç»ˆç‚¹çš„å€¼
- é¢„å¤„ç†æ—¶æ³¨æ„æ•°ç»„å¤§å°ï¼Œm = log2(k) + 1</p>

<hr />

<p><em>è·å–æ—¶é—´: 2026-02-26 19:55:57</em></p>

                </div>
            </div>

            <div class="footer">
                <p>ç”± <a href="https://github.com/LFrankl/leetcode" target="_blank">LeetCode Daily Script</a> è‡ªåŠ¨ç”Ÿæˆ</p>
                <p>AI è§£ç­”ç”± <a href="https://www.deepseek.com/" target="_blank">DeepSeek</a> æä¾›</p>
            </div>
        </div>
    </div>

    <!-- æµ®åŠ¨è¿”å›æŒ‰é’® -->
    <button class="fab-back" onclick="history.back()" aria-label="è¿”å›é¢˜ç›®åˆ—è¡¨">
        â†‘
    </button>
</body>
</html>